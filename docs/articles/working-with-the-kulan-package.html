<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Working with the Kulan package • Kulan</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Working with the Kulan package">
<meta property="og:description" content="Kulan">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Kulan</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Flight_summaries.html">Flight summaries</a>
    </li>
    <li>
      <a href="../articles/Getting_raster_values_form_a_Digital_Elevation_Model.html">Getting raster values form a Digital Elevation Model</a>
    </li>
    <li>
      <a href="../articles/working-with-the-kulan-package.html">Working with the Kulan package</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="working-with-the-kulan-package_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Working with the Kulan package</h1>
            
      
      
      <div class="hidden name"><code>working-with-the-kulan-package.Rmd</code></div>

    </div>

    
    
<div id="key-functions" class="section level2">
<h2 class="hasAnchor">
<a href="#key-functions" class="anchor"></a>Key functions</h2>
<div id="drone-flight-descriptors" class="section level3">
<h3 class="hasAnchor">
<a href="#drone-flight-descriptors" class="anchor"></a>Drone flight descriptors</h3>
<p><strong>Import some data</strong></p>
<p>The package has some flight datasets inside it that can be used for generating examples. You can add your own data using any of the read functions available in <a href="http://www.sthda.com/english/wiki/importing-data-into-r" class="uri">http://www.sthda.com/english/wiki/importing-data-into-r</a>. Usually we use the read.csv() to read in a .csv file. There are options for excel files and text files too.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span><span class="op">&lt;-</span><span class="fu">Kulan</span><span class="fu">::</span><span class="va"><a href="../reference/All_Flight_Right.html">All_Flight_Right</a></span></code></pre></div>
<p><strong>Tidy the data frame to make it more R friendly</strong></p>
<p>The dataframe has some column names that are not very “R friendly” because, for example, they have spaces in the names (e.g. “Alt above ground” ). The {janitor} package replaces the names with a more standard format (“alt_above_ground”)</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span><span class="op">&lt;-</span><span class="va">df</span> <span class="op">%&gt;%</span> 
  <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/janitor/man/clean_names.html">clean_names</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><strong>Get the ground in the image</strong></p>
<p>To calculate the width of a drone image we need to know the height of the drone and the angle of the cameras. The inbuilt functions in the {Kulan} package use the camera dimensions from the cameras used in the field as default values.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span><span class="op">&lt;-</span><span class="va">df</span> <span class="op">%&gt;%</span>
  <span class="fu">rowwise</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span><span class="st">"strip_width"</span><span class="op">=</span><span class="fu">Kulan</span><span class="fu">::</span><span class="fu"><a href="../reference/get_strip_width.html">get_strip_width</a></span><span class="op">(</span><span class="va">`alt_above_ground`</span><span class="op">)</span><span class="op">)</span> 

<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">strip_width</span><span class="op">)</span>
<span class="co">#&gt; [1] 493.2802</span></code></pre></div>
<p><strong>Get the ground surface distance</strong></p>
<p>To calculate the ground surface distance (1 pixel) there are two functions, one that assumes no distortion due to the angle of the camera and one that allows for distortion (this later function is still in development) .</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">df</span><span class="op">&lt;-</span><span class="va">df</span> <span class="op">%&gt;%</span>
  <span class="fu">rowwise</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span><span class="st">"get_GSD"</span><span class="op">=</span><span class="fu">Kulan</span><span class="fu">::</span><span class="fu"><a href="../reference/get_GSD.html">get_GSD</a></span><span class="op">(</span>Altitude <span class="op">=</span> <span class="va">`alt_above_ground`</span><span class="op">)</span><span class="op">)</span> 

<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">get_GSD</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="co"># this includes the drones take off and landing phases so needs to be recalculated </span>
<span class="co">#&gt; [1] 2.887035</span></code></pre></div>
</div>
<div id="abundance-estimators" class="section level3">
<h3 class="hasAnchor">
<a href="#abundance-estimators" class="anchor"></a>Abundance estimators</h3>
<p><strong>Simulate a dataset</strong></p>
<p>To simulate a dataset we can use the sim_kulan_data() function. To get help from the package please use the code below:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/help.html">help</a></span><span class="op">(</span><span class="st">"sim_kulan_data"</span><span class="op">)</span></code></pre></div>
<p>which outputs the details of the function:</p>
<hr>
</div>
<div id="sim_kulan_data-kulan-r-documentation" class="section level3">
<h3 class="hasAnchor">
<a href="#sim_kulan_data-kulan-r-documentation" class="anchor"></a>sim_kulan_data {Kulan} R Documentation</h3>
</div>
<div id="simulate-a-dataset" class="section level3">
<h3 class="hasAnchor">
<a href="#simulate-a-dataset" class="anchor"></a>Simulate a dataset</h3>
<div id="description" class="section level4">
<h4 class="hasAnchor">
<a href="#description" class="anchor"></a>Description</h4>
<p>Simulate a dataset</p>
</div>
<div id="usage" class="section level4">
<h4 class="hasAnchor">
<a href="#usage" class="anchor"></a>Usage</h4>
<p>sim_kulan_data(n = 100, ma = 25, p0 = 0.5, ml = 20, w = 0.2)</p>
</div>
<div id="arguments" class="section level4">
<h4 class="hasAnchor">
<a href="#arguments" class="anchor"></a>Arguments</h4>
<p>n number of transects</p>
<p>ma mean number of animals counted where they are counted</p>
<p>p0 proportion of the transects that will be empty</p>
<p>ml mean length of the transects</p>
<p>w width of the transects (assuming a constant width)</p>
<p>Value simulated data in a dataframe</p>
<hr>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data</span><span class="op">=</span><span class="fu">Kulan</span><span class="fu">::</span><span class="fu"><a href="../reference/sim_kulan_data.html">sim_kulan_data</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><strong>Run the Jolly2 model</strong></p>
<p>To run the Jolly2 model we can use the jolly2() function. Again using help() will output a description of the function.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/help.html">help</a></span><span class="op">(</span><span class="st">"jolly2"</span><span class="op">)</span></code></pre></div>
<hr>
</div>
</div>
<div id="jolly2-kulan-r-documentation" class="section level3">
<h3 class="hasAnchor">
<a href="#jolly2-kulan-r-documentation" class="anchor"></a>jolly2 {Kulan} R Documentation</h3>
</div>
<div id="calculate-jolly-ii-estimate-and-95-confidence-interval" class="section level3">
<h3 class="hasAnchor">
<a href="#calculate-jolly-ii-estimate-and-95-confidence-interval" class="anchor"></a>Calculate Jolly II estimate and 95% Confidence Interval</h3>
<div id="description-1" class="section level4">
<h4 class="hasAnchor">
<a href="#description-1" class="anchor"></a>Description</h4>
<p>Calculate Jolly II estimate and 95% Confidence Interval</p>
</div>
<div id="usage-1" class="section level4">
<h4 class="hasAnchor">
<a href="#usage-1" class="anchor"></a>Usage</h4>
<p>jolly2(species_count, Transect_area, Z = Z)</p>
</div>
<div id="arguments-1" class="section level4">
<h4 class="hasAnchor">
<a href="#arguments-1" class="anchor"></a>Arguments</h4>
<p>species_count the column from the dataset with the species counts in</p>
<p>Transect_area the column from the dataset with the transect areas in</p>
<p>Z the stratum area (the total area that we are extrapolating to)</p>
<p>Value dataframe with Jolly II estimate and 95% CI</p>
<hr>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/jolly2.html">jolly2</a></span><span class="op">(</span>species_count <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">sp_count</span>, Transect_area <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">Trans_area</span>,Z<span class="op">=</span><span class="fl">164</span><span class="op">*</span><span class="fl">5</span><span class="op">)</span>
<span class="co">#&gt;   Estimate lower_CI upper_CI      SE mean.y     SD.y Coef.of.Var.y</span>
<span class="co">#&gt; 1  2573.34 2263.567 2883.112 186.566  12.76 12.75972     0.9999782</span></code></pre></div>
<p><strong>Run the n-mixture model</strong></p>
<p>Finally, to run the n-mixture model you can use the run_kulan_model() function. See more details about this function using help().</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/help.html">help</a></span><span class="op">(</span><span class="st">"run_kulan_model"</span><span class="op">)</span></code></pre></div>
<hr>
</div>
</div>
<div id="run_kulan_model-kulan-r-documentation" class="section level3">
<h3 class="hasAnchor">
<a href="#run_kulan_model-kulan-r-documentation" class="anchor"></a>run_kulan_model {Kulan} R Documentation</h3>
</div>
<div id="calculate-bayesian-estimate-and-95-hdi" class="section level3">
<h3 class="hasAnchor">
<a href="#calculate-bayesian-estimate-and-95-hdi" class="anchor"></a>Calculate Bayesian estimate and 95% HDI</h3>
<div id="description-2" class="section level4">
<h4 class="hasAnchor">
<a href="#description-2" class="anchor"></a>Description</h4>
<p>Calculate Bayesian estimate and 95% HDI</p>
</div>
<div id="usage-2" class="section level4">
<h4 class="hasAnchor">
<a href="#usage-2" class="anchor"></a>Usage</h4>
<p>run_kulan_model( p_area = p_area., p_min = p_min., p_max = p_max., no_ind = no_ind., plot.out = “No” )</p>
</div>
<div id="arguments-2" class="section level4">
<h4 class="hasAnchor">
<a href="#arguments-2" class="anchor"></a>Arguments</h4>
<p>p_area proportion of the stratum that has been sampled</p>
<p>p_min prior minimum number of animals</p>
<p>p_max prior maximum number of animals</p>
<p>no_ind Indivduals count column from data</p>
<p>plot.out Add a plot (“Yes”) of the distribution of the estimate (default is “No”)</p>
<p>Value dataframe with estimate and hdi</p>
<hr>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mod1</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/run_kulan_model.html">run_kulan_model</a></span><span class="op">(</span>p_area <span class="op">=</span> <span class="fl">.49</span>, p_min <span class="op">=</span> <span class="fl">1000</span>, p_max<span class="op">=</span><span class="fl">4000</span>, no_ind <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">sp_count</span>, plot.out <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; Loading required package: coda</span>
<span class="co">#&gt; Loading required package: MASS</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'MASS'</span>
<span class="co">#&gt; The following object is masked from 'package:dplyr':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     select</span>
<span class="co">#&gt; ##</span>
<span class="co">#&gt; ## Markov Chain Monte Carlo Package (MCMCpack)</span>
<span class="co">#&gt; ## Copyright (C) 2003-2021 Andrew D. Martin, Kevin M. Quinn, and Jong Hee Park</span>
<span class="co">#&gt; ##</span>
<span class="co">#&gt; ## Support provided by the U.S. National Science Foundation</span>
<span class="co">#&gt; ## (Grants SES-0350646 and SES-0350613)</span>
<span class="co">#&gt; ##</span>
<span class="co">#&gt; Loading required package: lattice</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'jagsUI'</span>
<span class="co">#&gt; The following object is masked from 'package:coda':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     traceplot</span>
<span class="co">#&gt; The following object is masked from 'package:utils':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     View</span>
<span class="co">#&gt; Loading required package: HDInterval</span>
<span class="co">#&gt; Loading required package: mcmcOutput</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Processing function input....... </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Done. </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; Compiling model graph</span>
<span class="co">#&gt;    Resolving undeclared variables</span>
<span class="co">#&gt;    Allocating nodes</span>
<span class="co">#&gt; Graph information:</span>
<span class="co">#&gt;    Observed stochastic nodes: 1</span>
<span class="co">#&gt;    Unobserved stochastic nodes: 1</span>
<span class="co">#&gt;    Total graph size: 6</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Initializing model</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Adaptive phase..... </span>
<span class="co">#&gt; Adaptive phase complete </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; No burn-in specified </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; Sampling from joint posterior, 20000 iterations x 3 chains </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Calculating statistics....... </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Done.</span></code></pre></div>
<p><img src="working-with-the-kulan-package_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Matt Grainger, Petra Kaczensky.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
